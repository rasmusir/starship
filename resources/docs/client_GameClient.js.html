<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: client/GameClient.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: client/GameClient.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>"use strict";

let Game = require("../shared/Game");
let Renderer = require("./Renderer");
let Cube = require("../shared/cube");
let Ship = require("../shared/Objects/Ship");
let ClientRegion = require("./ClientRegion");
let Vector = require("../shared/Vector");
let ByteBuffer = require("../shared/ByteBuffer");
let Network = require("../shared/Network");

/**
* Base Game class
* @class
* @extends Game
*/
class GameClient extends Game
{
    constructor(siteHandler)
    {
        super();

        let socket = io(":6699");
        this._socket = socket;

        socket.on("connect", () => {
            socket.on("message", (data) => {
                let buffer = new ByteBuffer(data);
                this._handleData(buffer);
            });
        });


        let renderer = new Renderer(siteHandler);

        this._region = new ClientRegion(0, renderer, this);
        this.clientID = -1;

        this._buffer = new ByteBuffer();

        renderer.Animate( () => { this.Tick(); });
    }

    _handleData(buffer)
    {
        let scrap = false;
        while (buffer.GotData() &amp;&amp; !scrap)
        {
            switch (buffer.ReadByte())
            {
                case Network.REGION_CHANGE:
                {
                    let regionID = buffer.ReadShort();
                    this._region.ChangeState(regionID);
                    this._region.Sync(buffer);
                    break;
                }
                case Network.REGION_TICK:
                {
                    let regionID = buffer.ReadShort();
                    this._region.Receive(buffer);
                    break;
                }
                case Network.REGION_CREATE_OBJECT:
                {
                    let regionID = buffer.ReadShort();
                    let object = new (Network.Class(buffer.ReadShort()))(this._region);
                    let networkid = buffer.ReadShort();
                    object._networkID = networkid;
                    object.Sync(buffer);
                    this._region.Add(object);

                    break;
                }
                case Network.CONNECT:
                {
                    console.log("Signed in!");
                    this.ClientID = buffer.ReadShort();

                    break;
                }
                case Network.SERVER_MESSAGE:
                {
                    console.log("Server message: " + buffer.ReadString());
                    break;
                }
                default:{
                    console.error("Uknown command recceived, scrapping frame.");
                    scrap = true;
                }
            }
        }
    }

    Tick(deltaTime)
    {
        this._region.Tick(deltaTime);

        this._region.Send(this._buffer);

        this._socket.send(this._buffer.GetTrimmedBuffer());
        this._buffer.Reset();
    }
}

module.exports = GameClient;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="GameClient.html">GameClient</a></li><li><a href="Renderer.html">Renderer</a></li><li><a href="Vector.html">Vector</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Mar 07 2016 02:23:39 GMT+0100 (W. Europe Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
